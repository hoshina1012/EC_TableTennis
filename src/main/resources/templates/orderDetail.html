<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">    
    <link th:href="@{/css/content.css}" rel="stylesheet">
    <title>支払情報入力</title>
    <script>
        // 数字を3桁ごとにカンマで区切る関数
        function formatPrice(price) {
            return '￥' + price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        // 商品価格をフォーマットする関数
        function formatProductPrices() {
            const priceElements = document.querySelectorAll('.price_format');
            priceElements.forEach((element) => {
                const price = element.textContent.replace('￥', '');
                element.textContent = formatPrice(price);
            });
        }

        // DOMがロードされた後に商品価格をフォーマット
        document.addEventListener('DOMContentLoaded', formatProductPrices);
    </script>
</head>
<body>
	<div class="header_admin_container">
        <div class="header_logout">
            <a class="header_text" th:href="@{/}">ECサイト</a>
            <div>
                <span th:if="${username != null}" class="flex">
                    <a class="header_text" th:href="@{/users/1}">ようこそ、<span th:text="${username}">ユーザー</span>さん！</a>
                    <a>　</a>
                    <a class="header_text" th:href="@{/cart}">カート</a>
                    <form th:action="@{/logout}" method="post">
                        <div>
                            <button class="header_admin_button" type="submit">ログアウト</button>
                        </div>
                    </form>
                </span>
                <span th:if="${username == null}">
                    <a class="header_text" th:href="@{/login}">ログイン</a>
                    <a class="header_text" th:href="@{/signUp}">新規会員登録</a>
                </span>
            </div>
        </div>
    </div>

    <div class="container">
		<h1 th:text="'注文詳細: 注文ID ' + ${order.id}"></h1>
		    
	    <table>
	        <tr>
	            <th>注文ID</th>				
				<td	class="right_text" th:text="${order.id}"></td>
	        </tr>
	        <tr>						
				<th>注文ユーザー</th>
	            <td	class="right_text" th:text="${order.user.userName}"></td>
			</tr>
			<tr>			
				<th>注文日</th>
	            <td th:text="${#dates.format(order.createdAt, 'yyyy-MM-dd')}"></td>
			</tr>
	    </table><br>
		
		<table>
	        <tr>
				<th	width="30%">商品名</th>				
				<th	width="15%">種類</th>				
				<th	width="10%">数量</th>				
				<th	width="10%">単価</th>				
				<th	width="20%">受注ユーザー</th>				
				<th	width="15%">ステータス</th>
	        </tr>
			<tr th:each="orderItem : ${orderItems}">
		        <td class="center_text" th:text="${orderItem.product.name}"></td>
				<td class="center_text" th:text="${typeNames[orderItem.id]}"></td>
		        <td class="right_text" th:text="${orderItem.quantity}"></td>
		        <td class="price_format" th:text="${orderItem.product.price}"></td>				
				<td class="center_text" th:text="${orderItem.product.user.userName}"></td>
		        <td class="center_text" th:text="${orderItem.orderStatus == 0 ? '未発送' : '発送済'}"></td>
		    </tr>
	    </table><br>
		
		<h2>支払情報</h2>
				    
		<table>
		    <tr>
		        <th>カード番号</th>
		        <td class="right_text" th:text="${maskedCardNumber}">**** **** **** 1234</td>
		    </tr>
		    <tr>
		        <th>名前</th>
		        <td class="right_text" th:text="${cardHolder}">山田 太郎</td>
		    </tr>
		    <tr>
		        <th>支払日</th>
		        <td class="right_text" th:text="${paymentDate}">2024-11-24</td>
		    </tr>
		</table><br>
	
	    <a th:href="@{/admin/order}">注文一覧に戻る</a>
    </div>
</body>
</html>
